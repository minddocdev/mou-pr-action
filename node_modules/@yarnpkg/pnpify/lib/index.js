"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.patchFs = void 0;
const tslib_1 = require("tslib");
const fslib_1 = require("@yarnpkg/fslib");
const fs_1 = tslib_1.__importDefault(require("fs"));
const NodeModulesFS_1 = require("./NodeModulesFS");
const dynamicRequire_1 = require("./dynamicRequire");
let fsPatched = false;
let pnp;
try {
    pnp = (0, dynamicRequire_1.dynamicRequire)(`pnpapi`);
}
catch (e) {
}
const patchFs = () => {
    if (pnp && !fsPatched) {
        const realFs = { ...fs_1.default };
        const nodeModulesFS = new NodeModulesFS_1.NodeModulesFS(pnp, { realFs });
        (0, fslib_1.patchFs)(fs_1.default, nodeModulesFS);
        fsPatched = true;
    }
};
exports.patchFs = patchFs;
if (!process.mainModule)
    (0, exports.patchFs)();
